<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-900 text-white">
  <!-- BG -->
  <div id="bg" class="fixed inset-0 -z-10 bg-cover bg-center opacity-50"></div>

  <main class="min-h-screen grid place-items-center px-4 py-10">
    <div class="w-full max-w-3xl rounded-3xl bg-white text-slate-900 p-8 shadow-2xl">
      <h1 id="evTitle" class="text-2xl font-extrabold text-center mb-6">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h1>

      <div class="space-y-6">
        <div>
          <h2 class="text-xl font-semibold mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h2>
          <p id="evDesc" class="leading-7 text-slate-700">‚Äî</p>
        </div>

        <div class="grid sm:grid-cols-2 gap-4">
          <div><span class="font-medium">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span> <span id="evDate">‚Äî</span></div>
          <div><span class="font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</span> <span id="evLoc">‚Äî</span></div>
        </div>

        <div class="pt-2">
          <h2 class="text-xl font-semibold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h2>
          <input id="address" placeholder="address :"
                 class="w-full rounded-xl bg-indigo-100 px-4 py-3 outline-none ring-1 ring-indigo-300 focus:ring-2 focus:ring-indigo-500">
        </div>

        <div class="pt-2 flex justify-end">
          <button id="submitBtn"
            class="px-6 py-2.5 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-500 active:scale-[.99]">
            Submit
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- home shortcut -->
  <a href="./HOME‡∏ô‡∏®‡∏ó‡∏ï‡∏Å‡∏•‡∏ó‡∏ö.html" class="fixed bottom-5 right-5 h-12 w-12 grid place-items-center rounded-full bg-white text-black shadow-xl">üè†</a>

  <script>
    // ‡πÉ‡∏ä‡πâ‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤: local -> http://localhost:4000/api, prod (Vercel) -> /api
    const API_BASE =
      (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
        ? 'http://localhost:4000/api'
        : '/api';

    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    async function loadEvent() {
      if (!id) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏ô URL");
        location.href = "./HOME‡∏ô‡∏®‡∏ó‡∏ï‡∏Å‡∏•‡∏ó‡∏ö.html";
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/events/${encodeURIComponent(id)}`);
        if (!res.ok) {
          if (res.status === 404) {
            alert("‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏°‡πà‡∏û‡∏ö");
          } else {
            const txt = await res.text().catch(() => "");
            console.error("Load event failed:", res.status, txt);
            alert(`‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${res.status})`);
          }
          location.href = "./HOME‡∏ô‡∏®‡∏ó‡∏ï‡∏Å‡∏•‡∏ó‡∏ö.html";
          return;
        }

        const ev = await res.json();
        document.getElementById("evTitle").textContent = ev.title || "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°";
        document.getElementById("evDesc").textContent  = ev.description || "‚Äî";
        document.getElementById("evDate").textContent  = ev.dateText || "‚Äî";
        document.getElementById("evLoc").textContent   = ev.location || "‚Äî";
        if (ev.imageUrl) {
          document.getElementById("bg").style.backgroundImage = `url('${ev.imageUrl}')`;
        }
      } catch (err) {
        console.error(err);
        alert("‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤");
        location.href = "./HOME‡∏ô‡∏®‡∏ó‡∏ï‡∏Å‡∏•‡∏ó‡∏ö.html";
      }
    }

    document.getElementById("submitBtn").addEventListener("click", () => {
      const addr = document.getElementById("address").value.trim();
      alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + (addr || "(‡∏ß‡πà‡∏≤‡∏á)"));
    });

    loadEvent();
  </script>


</body>
</html>
